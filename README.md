# install_wordpress_using_ansible

## 要件
- 以下ansibleで自動化
  - linux上でのユーザー作成
  - Nginxインストールと設定
  - php,php-fpmのインストールと設定
  - MySQLバックアップシェルスクリプトの配置

## テスト証跡

```
fukuiryousukenoMacBook-Pro:ansible fukuiryousuke$ ansible-playbook -u vagrant --private-key="~/vagrant/dev/.vagrant/machines/default/virtualbox/private_key" -i hosts wordpress.yml

PLAY [all] *************************************************************************************************************************************************************************************************

TASK [Gathering Facts] *************************************************************************************************************************************************************************************
ok: [192.168.56.15]

TASK [common : include tasks/base-packages.yml] ************************************************************************************************************************************************************
included: /Users/fukuiryousuke/git/MENTA/ansible/roles/common/tasks/base-packages.yml for 192.168.56.15

TASK [common : yum update] *********************************************************************************************************************************************************************************
changed: [192.168.56.15]

TASK [common : yum install packages] ***********************************************************************************************************************************************************************
changed: [192.168.56.15] => (item=vim)
changed: [192.168.56.15] => (item=wget)
ok: [192.168.56.15] => (item=yum-utils)

TASK [common : include tasks/user.yml] *********************************************************************************************************************************************************************
included: /Users/fukuiryousuke/git/MENTA/ansible/roles/common/tasks/user.yml for 192.168.56.15

TASK [common : create user] ********************************************************************************************************************************************************************************
changed: [192.168.56.15] => (item={'shell': '/bin/bash', 'groups': 'wheel', 'state': 'present', 'name': 'menta', 'password': 'xxxxxx'})

TASK [common : add sudoers] ********************************************************************************************************************************************************************************
changed: [192.168.56.15] => (item={'match': 'menta', 'line': 'menta ALL=(ALL) NOPASSWD: ALL'})

TASK [common : authorized_key for user menta] **************************************************************************************************************************************************************
fatal: [192.168.56.15]: FAILED! => {"changed": false, "msg": "invalid key specified: authorized_keys"}
...ignoring

PLAY [menta_server] ****************************************************************************************************************************************************************************************

TASK [Gathering Facts] *************************************************************************************************************************************************************************************
ok: [192.168.56.15]

TASK [nginx : copy nginx.repo] *****************************************************************************************************************************************************************************
changed: [192.168.56.15] => (item={'src': 'roles/nginx/files/nginx.repo', 'dest': '/etc/yum.repos.d/'})

TASK [nginx : install nginx] *******************************************************************************************************************************************************************************
changed: [192.168.56.15] => (item=nginx)

TASK [nginx : start nginx] *********************************************************************************************************************************************************************************
changed: [192.168.56.15]

TASK [nginx : copy nginx conf] *****************************************************************************************************************************************************************************
changed: [192.168.56.15] => (item={'src': 'roles/nginx/files/conf.d', 'dest': '.'})

TASK [php : install remi epel] *****************************************************************************************************************************************************************************
changed: [192.168.56.15] => (item=http://rpms.famillecollet.com/enterprise/remi-release-7.rpm)
ok: [192.168.56.15] => (item=epel-release)

TASK [php : install php74] *********************************************************************************************************************************************************************************
changed: [192.168.56.15] => (item=php)
changed: [192.168.56.15] => (item=php-mbstring)
changed: [192.168.56.15] => (item=php-pdo)
changed: [192.168.56.15] => (item=php-mysqlnd)
changed: [192.168.56.15] => (item=php-fpm)

TASK [php : start php-fpm] *********************************************************************************************************************************************************************************
changed: [192.168.56.15]

TASK [php : copy php.ini] **********************************************************************************************************************************************************************************
changed: [192.168.56.15] => (item={'src': 'roles/php/files/php.ini', 'dest': '.'})

TASK [php : copy www.conf] *********************************************************************************************************************************************************************************
changed: [192.168.56.15] => (item={'src': 'roles/php/files/www.conf', 'dest': '.'})

TASK [mysql : remove mariadb] ******************************************************************************************************************************************************************************
changed: [192.168.56.15]

TASK [mysql : install rpm] *********************************************************************************************************************************************************************************
changed: [192.168.56.15] => (item=https://dev.mysql.com/get/mysql80-community-release-el7-5.noarch.rpm)

TASK [mysql : install mysqld] ******************************************************************************************************************************************************************************
changed: [192.168.56.15] => (item=mysql-community-server)

TASK [mysql : start mysqld] ********************************************************************************************************************************************************************************
changed: [192.168.56.15]

TASK [mysql : copy mysqld config] **************************************************************************************************************************************************************************
changed: [192.168.56.15] => (item={'src': 'roles/mysql/files/my.cnf', 'dest': '.'})

TASK [add_backupshell : copy mysqlbackup shellscript] ******************************************************************************************************************************************************
changed: [192.168.56.15] => (item={'src': 'roles/add_backupshell/files/mysqlbackup.sh', 'dest': '.'})

RUNNING HANDLER [nginx : restart nginx] ********************************************************************************************************************************************************************
changed: [192.168.56.15]

RUNNING HANDLER [php : restart php-fpm] ********************************************************************************************************************************************************************
changed: [192.168.56.15]

RUNNING HANDLER [mysql : restart mysqld] *******************************************************************************************************************************************************************
changed: [192.168.56.15]

PLAY RECAP *************************************************************************************************************************************************************************************************
192.168.56.15              : ok=27   changed=22   unreachable=0    failed=0    skipped=0    rescued=0    ignored=1
```